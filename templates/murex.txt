{%- let section = "# =============================================================================\n#" -%}
{%- let not_configured = "# -- not configured --" -%}

{{ section }}
# Utility functions for zoxide.
#

# cd + custom logic based on the value of _ZO_ECHO.
fexec builtin function __zoxide_cd {
    fexec builtin cd $PARAMS[0]
    {%- if echo %}
    fexec builtin out $PWD
    {%- endif %}
}

{{ section }}
# Hook configuration for zoxide.
#

{% match hook %}
{%- when InitHook::None -%}
{{ not_configured }}

{%- when InitHook::Prompt -%}
# Initialize hook to add new entries to the database.
fexec builtin event onPrompt __zoxide_hook=command-completion {
    exec zoxide add -- $PWD
}

{%- when InitHook::Pwd -%}
fexec builtin out "zoxide: PWD hooks are not supported on Murex."
fexec builtin out "        Use 'zoxide init murex --hook prompt' instead."

{%- endmatch %}

{{ section }}
# When using zoxide with --no-cmd, alias these internal functions as desired.
#

# Jump to a directory using only keywords.
fexec builtin function __zoxide_z {
    if { !$PARAMS } then {
        fexec function __zoxide_cd ~
        fexec builtin return
    }
    if { $PARAMS[0] == "-" } then {
        fexec function __zoxide_cd -
        fexec builtin return
    }
    exec zoxide query --exclude $PWD -- @PARAMS -> set: str __zoxide_result && fexec function __zoxide_cd $__zoxide_result
}

# Jump to a directory using interactive search.
fexec builtin function __zoxide_zi {
    exec zoxide query --interactive -- @PARAMS -> set: str __zoxide_result && fexec function __zoxide_cd $__zoxide_result
}

{{ section }}
# Commands for zoxide. Disable these using --no-cmd.
#

{%- match cmd %}
{%- when Some with (cmd) %}

function {{cmd}}  { __zoxide_z  @PARAMS }
function {{cmd}}i { __zoxide_zi @PARAMS }

{%- when None %}

{{ not_configured }}

{%- endmatch %}

{{ section }}
# To initialize zoxide, add this to your shell configuration file (usually ~/.murex_profile):
#
# zoxide init murex --hook prompt -> source
